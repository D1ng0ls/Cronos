<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cronograma e água</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
    <link rel="stylesheet" href="source/style/style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.3.2/jspdf.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/2.3.2/jspdf.plugin.autotable.js"></script>
</head>
<body id="body">
    <header id="header"></header>
    <div class="fixed hidden">
<textarea id="fixed" disabled></textarea>
    <i class="bi bi-pin-fill" onclick="unpin()"></i>
    </div>
    <main id="home">
        <div class="saudacoes-container container">
            <h3 id="saudacao"></h3>
            <i id="diaAtual"></i>
        </div>
        <div class="home-container container">
            <h1># Resumo</h1>
            <p class="atividade">Atividade atual: <i id="atAtual"></i></p>
            <p class="atividade">Próxima atividade: <i id="atProx"></i></p>
            <p class="atividade">Copos de água: <i id="coposCount"></i><a onclick="somaCopo(true)"> <i class="bi bi-plus-lg"></i></a><a onclick="somaCopo(false)"> <i class="bi bi-dash-lg"></i></a></p>
            <p class="atividade">Meta: <i id="meta"></i></p>
            <p class="atividade">Anotações: <i id="anotacaoCount"></i></p>
            <div class="list-atividade">
                <p class="atividade">Tarefas:</p>
                <ul>
                    <li>Concluídas: <i id="tasksFeitas"></i></li>
                    <li>Para Fazer: <i id="tasksNaoFeitas"></i></li>
                </ul>
            </div>
            
        </div>
        <div class="crono-water">
            <div id="cronograma" class="cronograma-container container">
                <h2><i class="bi bi-calendar3"></i> Cronograma <i class="bi bi-plus-lg" onclick="openAddRow(0)" id="add-note"></i> <i class="bi bi-download" onclick="downloadCrono()" id="download-note"></i></h2>
                <div class="add-row hidden">
                    <input type="time" id="hora" name="hora">
                    <input type="text" id="desc" name="desc">
                    <button type="submit" id="envia" onclick="addRow()">Salvar</button>
                </div>
                <div class="table-cronos">
                    <table id="table">
                        <thead>
                            <tr>
                                <th>Horário</th>
                                <th colspan="2">Atividade</th>
                            </tr>
                        </thead>
                        <tbody id="tabela">
                            <!-- <tr>
                                <td id="horario">
                                    11:10
                                </td>
                                <td id="atividade">
                                    Acordar
                                </td>
                                <td>
                                    <i class="bi bi-trash3" id="excluir" onclick="deleteRow()"></i>
                                    <i class="bi bi-pencil" id="editar" onclick="editRow()"></i>
                                </td>
                            </tr> -->
                        </tbody>
                    </table>
                    <audio id="tableSound" src="source/media/change-table.mp3"></audio>
                </div>
            </div>
            <div id="agua" class="agua-container container">
                <h2><i class="bi bi-cup-straw"></i> Consumo de Água</h2>

                <div id="timer">Próximo lembrete: <span id="time">00:00:00</span></div>

                <div class="btns">
                    <button id="startButton">INICIAR <i class="bi bi-play-fill"></i></button>

                        <input type="number" min="0" value="0" max="99" id="copos" onchange="contaCopos()">
                        <button id="sumButton" onclick="somaCopo(true)">
                            <i class="bi bi-plus-lg"></i>
                        </button>
                        <button id="minusButton" onclick="somaCopo(false)">
                            <i class="bi bi-dash-lg"></i>
                        </button>

                </div>

                <p id="coposBebidos"></p>
                <p class="aviso">Não se esqueça de beber água ao longo do dia!</p>
                <audio id="alarmSound" src="source/media/clock-alarm.mp3"></audio>
            </div>
        </div>
        <div id="notes" class="notes-container container">
            <h2><i class="bi bi-journals"></i> Anotações <i class="bi bi-plus-lg" onclick="addNote()" id="add-note"></i> <i class="bi bi-download" onclick="downloadNotes()" id="download-note"></i></h2>
            <div id="notations" class="notations">
                <!-- <div class="note note${countNotes}"><i class="bi bi-pin" id="pin"></i><i class="bi bi-trash3" id="excluir"></i><textarea name="note${countNotes}" id="note${countNotes}"></textarea></div> -->
            </div>
        </div>
        <div id="tarefas" class="tarefas-container container">
            <h2><i class="bi bi-list-check"></i> Tarefas <i class="bi bi-plus-lg" onclick="addTask()" id="add-note"></i></h2>
            <div class="tasks-todo" id="tasks">
                <!-- <div class="task task1" id="task1">
                    <input type="text" name="task1" id="todo1" maxlength="50">
                    <input type="checkbox" name="check1" id="check1">
                    <i class="bi bi-trash3" id="excluir"></i>
                    <i class="hidden" id="dataTask1"></i>
                </div> -->
            </div>
        </div>
    </main>
    <div class="unlock" id="unlock">
        <form>
            <div class="input-unlock">
                <label for="senha">Senha:</label>
                <input type="password" id="senha" name="senha">
            </div>
            <button type="submit" id="btn-unlock">Desbloquear <i class="bi bi-unlock"></i></button>
        </form>
    </div>
    <footer id="footer"></footer>

    <noscript>Ative o JavaScript na página para ativar as funcionalidades</noscript>
    <script src="source/script/include.js"></script>
    <script src="source/script/table.js"></script>
    <script src="source/script/water.js"></script>
    <script src="source/script/cups.js"></script>
    <script src="source/script/configs.js"></script>
    <script src="source/script/notes.js"></script>
    <script src="source/script/tasks.js"></script>
    <script src="source/script/login.js"></script>
    <script>
        var data = new Date;
        var hour = data.getHours();
        var diaAtual = document.getElementById("diaAtual");
        const diaSemana = ["Domingo", "Segunda-Feira", "Terça-Feira", "Quarta-Feira", "Quinta-Feira", "Sexta-Feira", "Sábado"]
        const mesNome = ["Janeiro", "Fevereiro", "Março", "Abril", "Maio", "Junho", "Julho", "Agosto", "Setembro", "Outubro", "Novembro", "Dezembro"]
        
        var saudacao = document.getElementById('saudacao');

        var dots = 0;

        msgDia();
        
        function msgDia() {
            data = new Date;
            hour = data.getHours()
            diaAtual.innerHTML = diaSemana[data.getDay()] + ", " + data.getDate() + " de " + mesNome[data.getMonth()] + " de " + data.getFullYear() + " - " + data.getHours() + "h " + data.getMinutes() + "min";
            dots++;

            if (dots <= 3) {
                for(var i=0; i<dots; i++) {
                    diaAtual.innerHTML += "."
                }
            } else {
                diaAtual.innerHTML = diaSemana[data.getDay()] + ", " + data.getDate() + " de " + mesNome[data.getMonth()] + " de " + data.getFullYear() + " - " + data.getHours() + "h " + data.getMinutes() + "min";   
                dots = 0;
            }
            
        }

        setInterval(msgDia, 400)

        if(hour < 12) {
            saudacao.innerHTML += "<i class='bi bi-sunrise'></i> Bom dia, ";
        } else {
            if(hour < 18) {
                saudacao.innerHTML += "<i class='bi bi-sun'></i> Boa tarde, ";
            } else {
                saudacao.innerHTML += "<i class='bi bi-moon'></i> Boa noite, ";
            }
        }
        saudacao.innerHTML += getSettingValue('nome');

        document.getElementById("meta").textContent = getSettingValue('cups') + " Copos";
        contaCopos();

        timer(getSettingValue("mins"));

        atualizaContadorTask();
        carregaRow();
    </script>
    <script>
        // resetNote()
        // resetTask()
        // resetRow()

        if(localStorage.getItem('pinnedId') == null) {
            localStorage.setItem('pinnedId', 0)
        }

        if(localStorage.getItem('pinnedId') != 0) {    
            getPin(localStorage.getItem('pinnedId'))
            console.log("pinned global is " + localStorage.getItem('pinnedId'))
        }
        
        function pinned(note) {
            if (localStorage.getItem('pinnedId') != note) {
                document.getElementById('fixed').textContent = document.getElementById('note'+ note).textContent
                document.querySelector('.fixed').classList.remove("hidden")
                
                localStorage.setItem('pinnedId', note)
            } else {
                document.querySelector('.fixed').classList.add("hidden")
                localStorage.setItem('pinnedId', 0)         
            }

            console.log("pinned global is " + localStorage.getItem('pinnedId'))
        }

        function getPin(note) {
            document.getElementById('fixed').textContent = document.getElementById('note'+ note).textContent
            document.querySelector('.fixed').classList.remove("hidden")
        }

        function unpin() {
            pinned(localStorage.getItem('pinnedId'))
        }
    </script>
    <script>
        function downloadCrono() {
            var doc = new jsPDF('p', 'pt');
            var elem = document.getElementById("table");
            var res = doc.autoTableHtmlToJson(elem);
            doc.autoTable(res.columns, res.data, {
                theme: 'grid',
                styles: {
                    halign: 'center'
                },
                columnStyles: {
                    1: { halign: 'left'}
                }
            });

            doc.save("cronograma.pdf");
        }

        function downloadNotes() {
            let content = "";

            for (var i = 1; i <= localStorage.getItem('countNotesStorage'); i++) {
                try {
                    content += `Anotação ${i}: \n${document.getElementById('note'+i).textContent}\n\n`;
                } catch (ex) {
                    content += '';
                }
            }

            
            const blob = new Blob([content], { type: "text/plain" });
            const url = URL.createObjectURL(blob);

            const a = document.createElement("a");
            a.href = url;
            a.download = "anotacoes.txt";
            document.body.appendChild(a);
            a.click();

            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }
    </script>
</body>
</html>